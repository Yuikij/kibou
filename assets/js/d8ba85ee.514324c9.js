"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4755],{28453:(e,n,o)=>{o.d(n,{R:()=>d,x:()=>s});var i=o(96540);const l={},r=i.createContext(l);function d(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),i.createElement(r.Provider,{value:n},e.children)}},57062:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>t,contentTitle:()=>s,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"database/MySQL/\u65e5\u5fd7\u7cfb\u7edf/redoLog","title":"Redo log","description":"\u57fa\u672c\u6982\u5ff5","source":"@site/docs/database/MySQL/\u65e5\u5fd7\u7cfb\u7edf/redoLog.mdx","sourceDirName":"database/MySQL/\u65e5\u5fd7\u7cfb\u7edf","slug":"/database/MySQL/\u65e5\u5fd7\u7cfb\u7edf/redoLog","permalink":"/kibou/docs/database/MySQL/\u65e5\u5fd7\u7cfb\u7edf/redoLog","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Redo log"},"sidebar":"database","previous":{"title":"Binlog","permalink":"/kibou/docs/database/MySQL/\u65e5\u5fd7\u7cfb\u7edf/binLog"},"next":{"title":"Undo log","permalink":"/kibou/docs/database/MySQL/\u65e5\u5fd7\u7cfb\u7edf/undoLog"}}');var l=o(74848),r=o(28453);const d={title:"Redo log"},s=void 0,t={},c=[{value:"\u57fa\u672c\u6982\u5ff5",id:"\u57fa\u672c\u6982\u5ff5",level:2},{value:"\u7279\u70b9",id:"\u7279\u70b9",level:2},{value:"\u6d89\u53ca\u6982\u5ff5",id:"\u6d89\u53ca\u6982\u5ff5",level:2},{value:"1. WAL",id:"1-wal",level:3},{value:"2. Redo Log Buffer",id:"2-redo-log-buffer",level:3},{value:"3. Redo Log Files",id:"3-redo-log-files",level:3},{value:"4. \u4e24\u4e2a\u6307\u9488",id:"4-\u4e24\u4e2a\u6307\u9488",level:3},{value:"5. \u810f\u9875\uff1a",id:"5-\u810f\u9875",level:3},{value:"\u5982\u4f55\u5de5\u4f5c\u7684",id:"\u5982\u4f55\u5de5\u4f5c\u7684",level:2},{value:"\u5237\u65b0\u7b56\u7565 (\u7531 innodb_flush_log_at_trx_commit \u53c2\u6570\u63a7\u5236):",id:"\u5237\u65b0\u7b56\u7565-\u7531-innodb_flush_log_at_trx_commit-\u53c2\u6570\u63a7\u5236",level:2},{value:"\u5d29\u6e83\u6062\u590d\u7684\u6d41\u7a0b",id:"\u5d29\u6e83\u6062\u590d\u7684\u6d41\u7a0b",level:2},{value:"\u6587\u4ef6\u7ed3\u6784",id:"\u6587\u4ef6\u7ed3\u6784",level:2},{value:"\u4f18\u5316",id:"\u4f18\u5316",level:2},{value:"Q&amp;A",id:"qa",level:2},{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:2},{value:"\u67e5\u8be2",id:"\u67e5\u8be2",level:2}];function a(e){const n={admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"\u57fa\u672c\u6982\u5ff5",children:"\u57fa\u672c\u6982\u5ff5"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"The redo log is a disk-based data structure used during crash recovery to correct data written by incomplete transactions"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["\u57fa\u4e8e\u78c1\u76d8\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4fdd\u8bc1\u4e86\u5d29\u6e83\u6062\u590d\uff0c\u4fdd\u8bc1",(0,l.jsx)(n.strong,{children:"\u5df2\u63d0\u4ea4\u4e8b\u52a1"}),"\u7684\u6062\u590d(\u9632\u6b62\u4e22\u6389\u5185\u5b58\u6570\u636e)\uff0c\u5e76\u4e14\u901a\u8fc7WAL\u52a0\u5feb\u4e86\u5199\u5165\u7684\u6548\u7387\u3002"]}),"\n",(0,l.jsx)(n.h2,{id:"\u7279\u70b9",children:"\u7279\u70b9"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u987a\u5e8f\u7684\u78c1\u76d8\u5199\u5165\uff08\u56e0\u4e3a\u662f\u65e5\u5fd7\u8ffd\u52a0\u7684\u65b9\u5f0f\uff09\uff0c\u63d0\u9ad8\u5199\u5165\u6548\u7387"}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.strong,{children:"redo log \u548cbuffer pool\u7684\u5408\u4f5c\uff1a\u6709\u4e86redo log\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u653e\u5fc3\u7684\u4f7f\u7528\u5185\u5b58\u505a\u7f13\u5b58\uff0c\u4e0d\u6015\u6570\u636e\u4e22\u5931\uff0c\u628a\u5b9e\u9645\u7684\u4fee\u6539\u9875\u7684\u968f\u673a\u64cd\u4f5c\u53d8\u6210\u987a\u5e8f\u7684\u5199\u64cd\u4f5c\u8ffd\u52a0"})}),"\n",(0,l.jsxs)(n.li,{children:["WAL\uff1aWrite-Ahead Logging","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5728\u4e8b\u52a1\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u4fee\u6539\u4e4b\u524d\uff0c\u5148\u5c06\u4fee\u6539\u7684\u64cd\u4f5c\u8bb0\u5f55\u5230\u4e00\u4e2a\u6301\u4e45\u7684\u65e5\u5fd7\u6587\u4ef6\u4e2d"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"\u5d29\u6e83\u6062\u590d\uff1a\u6062\u590d\u672a\u6301\u4e45\u5316\u7684\u5185\u5b58\u6570\u636e"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u6d89\u53ca\u6982\u5ff5",children:"\u6d89\u53ca\u6982\u5ff5"}),"\n",(0,l.jsx)(n.h3,{id:"1-wal",children:"1. WAL"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Write-Ahead Logging \uff0c\u5148\u5199\u65e5\u5fd7\uff0c\u518d\u5199\u6570\u636e\uff0c\u5728\u4efb\u4f55\u4fee\u6539\u6570\u636e\u7684\u64cd\u4f5c\u4e4b\u524d\uff0c\u5fc5\u987b\u8bb2\u64cd\u4f5c\u8bb0\u5f55\u5230\u72ec\u7acb\u7684\u65e5\u5fd7\u6587\u4ef6\u4e2d\uff0c\u76ee\u7684\u662f\u786e\u4fdd\u6570\u636e\u7684\u6301\u4e45\u6027\u548c\u4e00\u81f4\u6027\u3002"}),"\n",(0,l.jsx)(n.li,{children:"\u65e5\u5fd7\u4e00\u822c\u8bb0\u5f55\u7684\u662f\u53d8\u66f4\u5185\u5bb9\uff0c\u5305\u62ec\u4e86\u6570\u636e\u4fee\u6539\u7684\u7ec6\u8282\uff08\u65b0\u503c\u548c\u65e7\u503c\uff09\u8fd8\u6709\u4e8b\u52a1\u6807\u8bc6\u3002"}),"\n",(0,l.jsx)(n.li,{children:"\u5f53\u7cfb\u7edf\u53d1\u751f\u5d29\u6e83\u7684\u65f6\u5019\uff0c\u4f1a\u6839\u636e\u65e5\u5fd7\u7684\u8bb0\u5f55\uff0c\u6062\u590d\u5230\u6700\u8fd1\u7684\u4e00\u6b21\u4e00\u81f4\u7684\u72b6\u6001\u3002"}),"\n",(0,l.jsx)(n.li,{children:"Checkpoint\uff0c\u7cfb\u7edf\u4f1a\u5c06\u65e5\u5fd7\u5b9a\u671f\u5237\u5165\u6570\u636e\u5e93\uff0c\u8fd9\u4e2a\u70b9\u5c31\u662fCheckpoint\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"2-redo-log-buffer",children:"2. Redo Log Buffer"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u91cd\u505a\u65e5\u5fd7\u7f13\u51b2\u533a: \u4e00\u5757\u5185\u5b58\u533a\u57df\uff0c\u7528\u4e8e\u4e34\u65f6\u5b58\u653e\u5373\u5c06\u5199\u5165 redo log \u6587\u4ef6\u7684\u65e5\u5fd7\u8bb0\u5f55\u3002 \u9ed8\u8ba4\u5927\u5c0f\u4e3a 16MB\uff0c\u53ef\u4ee5\u901a\u8fc7 innodb_log_buffer_size \u53c2\u6570\u914d\u7f6e\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"3-redo-log-files",children:"3. Redo Log Files"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u78c1\u76d8\u4e0a\u7684\u7269\u7406\u6587\u4ef6\uff0c\u7528\u4e8e\u6301\u4e45\u5316\u5b58\u50a8 redo log \u8bb0\u5f55\u3002InnoDB \u9ed8\u8ba4\u4f7f\u7528\u4e00\u7ec4\u5faa\u73af\u5199\u5165\u7684 redo log \u6587\u4ef6\uff0c\u901a\u5e38\u547d\u540d\u4e3a ib_logfile0, ib_logfile1 \u7b49\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728\u6570\u636e\u76ee\u5f55\uff08data directory\uff09\u4e0b\u521b\u5efa\u3002\n\u53ef\u4ee5\u901a\u8fc7 innodb_log_group_home_dir \u548c innodb_log_file_size, innodb_log_files_in_group \u53c2\u6570\u914d\u7f6e redo log \u6587\u4ef6\u7684\u4f4d\u7f6e\u3001\u5927\u5c0f\u548c\u6570\u91cf\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"4-\u4e24\u4e2a\u6307\u9488",children:"4. \u4e24\u4e2a\u6307\u9488"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"checkpoint\uff0c\u7cfb\u7edf\u6700\u540e\u4e00\u6b21\uff08Buffer Pool \u810f\u9875\uff09\u5237\u5165\u78c1\u76d8\u7684\u70b9\u3002write pos\uff0c\u7cfb\u7edf\u5f53\u524d\u6700\u65b0\u7684\u8bb0\u5f55\u70b9\u3002\u5f53write pos\u8ffd\u4e0acheckpoint\u5c31\u8868\u793a\u6ca1\u7a7a\u95f4\u4e86\uff0c\u9700\u8981\u5199\u56de\u78c1\u76d8\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"5-\u810f\u9875",children:"5. \u810f\u9875\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Buffer Pool\u4e2d\u4e0e\u78c1\u76d8\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u9875"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u5982\u4f55\u5de5\u4f5c\u7684",children:"\u5982\u4f55\u5de5\u4f5c\u7684"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"\u57fa\u4e8e\u4e8b\u52a1"}),"\n"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u4e8b\u52a1\u5f00\u59cb"}),"\uff1a \u5f53\u4e8b\u52a1\u542f\u52a8\u65f6\uff0cMySQL\u4f1a\u4e3a\u8be5\u4e8b\u52a1\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u7684\u4e8b\u52a1ID\uff0c\u540c\u65f6\u5728\u5185\u5b58\u4e2d\u4e3a\u8be5\u4e8b\u52a1\u5206\u914d\u4e00\u4e2aRedo Log Buffer\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u6570\u636e\u4fee\u6539"}),"\uff1a\u5728\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u5f53\u5bf9\u6570\u636e\u8fdb\u884c\u4fee\u6539\uff08\u63d2\u5165\u3001\u66f4\u65b0\u3001\u5220\u9664\uff09\u65f6\uff0c\u8fd9\u4e9b\u4fee\u6539\u64cd\u4f5c\u4f1a\u9996\u5148\u88ab\u5199\u5165\u5230\u4e8b\u52a1\u7684Redo Log Buffer\u4e2d\u3002\u8fd9\u662f\u4e00\u4e2a\u5f88\u5feb\u7684\u64cd\u4f5c\uff0c\u56e0\u4e3a\u5b83\u6d89\u53ca\u7684\u662f\u5728\u5185\u5b58\u4e2d\u7684\u7f13\u51b2\u533a\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u6301\u4e45\u5316\u78c1\u76d8"}),"\uff1a\u4e00\u65e6Redo Log Buffer\u6ee1\u4e86\uff0c\u6216\u8005\u5f53\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0cMySQL\u4f1a\u5c06Redo Log Buffer\u4e2d\u7684\u65e5\u5fd7\u8bb0\u5f55\u5199\u5165\u5230Redo Log\u6587\u4ef6\u4e2d\uff0c\n\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u5728\u4fee\u6539\u5b9e\u9645\u6570\u636e\u4e4b\u524d\uff0c\u4e5f\u5c31\u662fWAL\u3002\u7136\u540e\u66f4\u65b0write pos\uff0c\u5f53\u524d\u5199\u5165\u7684\u4f4d\u7f6e\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u66f4\u65b0Checkpoint"}),"\uff1a\u5f53Redo Log\u7684\u8bb0\u5f55\u88ab\u5199\u5165\u5230\u6570\u636e\u9875\uff0c\u66f4\u65b0Checkpoint\uff0cCheckpoint\u5305\u62ec\u4e86LSN\u7684\u4fe1\u606f\uff0cCheckpoint\u5f80\u524d\u7684\u90fd\u53ef\u4ee5\u5220\u4e86"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"\u6587\u4ef6\u5faa\u73af"}),"\uff1a\u5f53\u4e00\u4e2aRedo Log\u6587\u4ef6\u5199\u6ee1\u6216\u8fbe\u5230\u4e00\u5b9a\u6761\u4ef6\u65f6\uff0cMySQL\u4f1a\u5207\u6362\u5230\u4e0b\u4e00\u4e2aRedo Log\u6587\u4ef6"]}),"\n"]}),"\n",(0,l.jsx)(n.admonition,{type:"tip",children:(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Redo Log Buffer\uff1a\u5b58\u50a8\u4e8b\u52a1\u4e2d\u7684\u4fee\u6539\u64cd\u4f5c\u7684\u5185\u5b58\u7f13\u51b2\u533a\uff0c\u7528\u4e8e\u4e8b\u52a1\u7684\u6301\u4e45\u6027\u548c\u6062\u590d\uff0c\u5f02\u6b65\u5199\u5165\u78c1\u76d8\uff0c",(0,l.jsx)(n.strong,{children:"\u548c\u78c1\u76d8\u7684\u6570\u636e\u9875\u6ca1\u6709\u76f4\u63a5\u7684\u5173\u7cfb"}),"\u3002"]}),"\n",(0,l.jsx)(n.li,{children:"InnoDB Buffer Pool\uff1a\u5305\u542b\u4e86\u8868\u548c\u7d22\u5f15\u7684\u5b9e\u9645\u6570\u636e\u3002\u4ece\u800c\u51cf\u5c11\u4e86\u78c1\u76d8 I/O \u64cd\u4f5c\uff0c\u63d0\u9ad8\u4e86\u6570\u636e\u8bfb\u5199\u7684\u6548\u7387\uff08\u5237\u65b0\u810f\u9875\uff09\u3002"}),"\n"]})}),"\n",(0,l.jsx)(n.h2,{id:"\u5237\u65b0\u7b56\u7565-\u7531-innodb_flush_log_at_trx_commit-\u53c2\u6570\u63a7\u5236",children:"\u5237\u65b0\u7b56\u7565 (\u7531 innodb_flush_log_at_trx_commit \u53c2\u6570\u63a7\u5236):"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"innodb_flush_log_at_trx_commit \u53c2\u6570\u63a7\u5236\u7740 redo log buffer \u4f55\u65f6\u5237\u65b0\u5230 redo log \u6587\u4ef6\uff08\u4e0e\u5237\u65b0\u6570\u636e\u9875\u65e0\u5173\uff09\u3002\u5b83\u5bf9\u4e8b\u52a1\u7684\u6301\u4e45\u6027\u548c\u6027\u80fd\u6709\u91cd\u8981\u5f71\u54cd\uff0c\u6709\u4e09\u4e2a\u53ef\u9009\u503c\uff1a"}),"\n"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"0: \u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0credo log buffer \u7684\u5185\u5bb9\u4e0d\u4f1a\u7acb\u5373\u5237\u65b0\u5230 redo log \u6587\u4ef6\uff0c\u800c\u662f\u4f9d\u8d56\u4e8e InnoDB \u7684\u540e\u53f0\u7ebf\u7a0b (master thread) \u6bcf\u79d2\u5237\u65b0\u4e00\u6b21\u5230 redo log \u6587\u4ef6\uff0c\u4f46\u4e0d\u4f1a\u7acb\u5373\u5237\u5230\u78c1\u76d8\uff08\u4ec5\u5237\u65b0\u5230\u6587\u4ef6\u7cfb\u7edf\u7f13\u5b58\uff09\u3002 \u7cfb\u7edf\u5d29\u6e83\u65f6\uff0c\u53ef\u80fd\u4f1a\u4e22\u5931 \u4e0a\u4e00\u79d2 \u63d0\u4ea4\u7684\u4e8b\u52a1\u3002 \u6027\u80fd\u6700\u597d\uff0c\u4f46\u6301\u4e45\u6027\u6700\u5f31\u3002"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"\u82f1\u6587\u89e3\u91ca: At transaction commit, redo log buffer content is not immediately flushed to redo log files. Instead, it relies on InnoDB's background thread (master thread) to flush to redo log files every second, but not immediately to disk (only to file system cache). In case of a system crash, transactions committed in the last second may be lost. Best performance, weakest durability."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:["1: ",(0,l.jsx)(n.strong,{children:"(\u9ed8\u8ba4\u503c)"})," \u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0credo log buffer \u7684\u5185\u5bb9\u4f1a\u7acb\u5373\u5237\u65b0\u5230 redo log \u6587\u4ef6 (\u4f4d\u4e8e\u6587\u4ef6\u7cfb\u7edf\u7f13\u5b58\u4e2d)\uff0c\u5e76\u4e14\u7acb\u5373\u5c06 redo log \u6587\u4ef6\u5237\u65b0\u5230\u78c1\u76d8 (fsync \u64cd\u4f5c)\u3002 \u8fd9\u662f ACID \u5c5e\u6027\u7684\u5b8c\u5168\u4fdd\u8bc1\uff0c\u4e5f\u662f \u6700\u5b89\u5168 \u7684\u8bbe\u7f6e\uff0c\u4f46 \u6027\u80fd\u76f8\u5bf9\u8f83\u4f4e\uff0c\u56e0\u4e3a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u90fd\u9700\u8981\u8fdb\u884c\u78c1\u76d8 I/O\u3002"]}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"\u82f1\u6587\u89e3\u91ca: (Default value) At transaction commit, redo log buffer content is immediately flushed to redo log files, and the redo log files are immediately flushed to disk (fsync operation). This provides full ACID property guarantee and is the safest setting, but with relatively lower performance because each transaction commit requires disk I/O."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"2: \u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0credo log buffer \u7684\u5185\u5bb9\u4f1a\u7acb\u5373\u5237\u65b0\u5230 redo log \u6587\u4ef6\uff0c\u4f46 redo log \u6587\u4ef6\u53ea\u4f1a\u5237\u65b0\u5230\u6587\u4ef6\u7cfb\u7edf\u7f13\u5b58\uff0c\u800c\u4e0d\u662f\u7acb\u5373\u5237\u5230\u78c1\u76d8\u3002 \u5237\u5230\u78c1\u76d8\u7684\u64cd\u4f5c\u7531\u64cd\u4f5c\u7cfb\u7edf\u63a7\u5236\uff0c\u901a\u5e38\u662f\u5468\u671f\u6027\u7684\u3002 \u76f8\u6bd4\u4e8e innodb_flush_log_at_trx_commit=1\uff0c\u6027\u80fd\u6709\u6240\u63d0\u5347\uff0c\u4f46\u5982\u679c\u64cd\u4f5c\u7cfb\u7edf\u6216\u786c\u4ef6\u5d29\u6e83 (\u4f8b\u5982\uff0c\u65ad\u7535)\uff0c\u53ef\u80fd\u4f1a\u4e22\u5931 \u6587\u4ef6\u7cfb\u7edf\u7f13\u5b58\u4e2d \u7684 redo log \u8bb0\u5f55\uff0c\u4ece\u800c\u5bfc\u81f4 \u6700\u540e\u4e00\u6b21\u5237\u65b0\u5230\u78c1\u76d8\u4e4b\u540e \u63d0\u4ea4\u7684\u4e8b\u52a1\u4e22\u5931\u3002 \u6027\u80fd\u548c\u6301\u4e45\u6027\u4ecb\u4e8e 0 \u548c 1 \u4e4b\u95f4\u3002"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"\u82f1\u6587\u89e3\u91ca: At transaction commit, redo log buffer content is immediately flushed to redo log files, but the redo log files are only flushed to the file system cache, not immediately to disk. Flushing to disk is controlled by the operating system, usually periodically. Compared to innodb_flush_log_at_trx_commit=1, performance is improved, but if the operating system or hardware crashes (e.g., power outage), redo log records in the file system cache may be lost, potentially leading to the loss of transactions committed after the last flush to disk. Performance and durability are between 0 and 1."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u5176\u4ed6\u7684\u65f6\u673a\uff1awrite pos\u8ffd\u4e0acheckpoint"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u901a\u5e38\u5efa\u8bae\u4f7f\u7528 innodb_flush_log_at_trx_commit=1\uff0c\u4ee5\u786e\u4fdd\u6570\u636e\u5b89\u5168\u548c\u4e8b\u52a1\u7684\u6301\u4e45\u6027\u3002 \u5728\u5bf9\u6570\u636e\u5b89\u5168\u6027\u8981\u6c42\u4e0d\u9ad8\uff0c\u4f46\u5bf9\u6027\u80fd\u8981\u6c42\u6781\u9ad8\u7684\u573a\u666f\u4e0b\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 innodb_flush_log_at_trx_commit=2 \u6216 0\uff0c\u4f46\u9700\u8981\u6743\u8861\u6570\u636e\u4e22\u5931\u7684\u98ce\u9669"}),"\n",(0,l.jsx)(n.h2,{id:"\u5d29\u6e83\u6062\u590d\u7684\u6d41\u7a0b",children:"\u5d29\u6e83\u6062\u590d\u7684\u6d41\u7a0b"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u901a\u8fc7redo log\u627e\u5230\u6700\u8fd1\u4e00\u6b21checkpoint\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u6839\u636echeckpoint\u76f8\u5bf9\u5e94\u7684LSN\u5f00\u59cb\uff0c\u83b7\u53d6\u9700\u8981\u91cd\u505a\u7684\u65e5\u5fd7\u3002"}),"\n",(0,l.jsx)(n.li,{children:"\u786e\u5b9a\u9700\u8981\u56de\u6eda\u548c\u9700\u8981\u63d0\u4ea4\u7684\u4e8b\u52a1id\uff0cXID\uff08Transaction ID\uff09"}),"\n",(0,l.jsxs)(n.li,{children:["redo log\u56de\u653e\uff0c\u8bfb\u53d6\u8bb0\u5f55\u5e76\u5e94\u7528\u5230\u5df2\u63d0\u4ea4\u7684\u4e8b\u52a1","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u627e\u5230 XID\uff1a \u4ece prepare \u8bb0\u5f55\u4e2d\u627e\u5230 XID\uff0c\u5373\u4e8b\u52a1\u6807\u8bc6\u7b26"}),"\n",(0,l.jsx)(n.li,{children:"\u5982\u679c\u78b0\u5230\u65e2\u6709prepare\u3001\u53c8\u6709commit\u7684redo log\uff0c\u5c31\u76f4\u63a5\u63d0\u4ea4"}),"\n",(0,l.jsxs)(n.li,{children:["\u5982\u679c\u78b0\u5230\u53ea\u6709prepare\u3001\u800c\u6ca1\u6709commit\u7684redo log\uff0c\u5c31\u62ff\u7740XID\u53bbbinlog\u627e\u5bf9\u5e94\u7684\u4e8b\u52a1\uff0c\u67e5\u770bbinlog\u662f\u5426\u5b8c\u6574","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5982\u679c\u5b8c\u6574\uff0c\u5219\u91cd\u505a\uff0c\u4e0d\u5b8c\u6574\u5219\u64a4\u9500"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u6587\u4ef6\u7ed3\u6784",children:"\u6587\u4ef6\u7ed3\u6784"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u8bb0\u5f55\u4e86\u6570\u636e\u9875\u7684\u7269\u7406\u4fee\u6539"}),"\n",(0,l.jsxs)(n.li,{children:["Ordinary redo log files","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u666e\u901a\u7684redo log\u6587\u4ef6\uff0c\u6b63\u5728\u4f7f\u7528\u7684\uff0c\u4f7f\u7528#ib_redoN\u547d\u540d"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Spare redo log files","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u7a7a\u95f2\u7684redo log\u6587\u4ef6\uff0c\u4f7f\u7528#ib_redoN_tmp\u547d\u540d"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"'#ib_redo582'  '#ib_redo590'  '#ib_redo598'      '#ib_redo606_tmp'\n'#ib_redo583'  '#ib_redo591'  '#ib_redo599'      '#ib_redo607_tmp'\n'#ib_redo584'  '#ib_redo592'  '#ib_redo600'      '#ib_redo608_tmp'\n'#ib_redo585'  '#ib_redo593'  '#ib_redo601'      '#ib_redo609_tmp'\n'#ib_redo586'  '#ib_redo594'  '#ib_redo602'      '#ib_redo610_tmp'\n'#ib_redo587'  '#ib_redo595'  '#ib_redo603_tmp'  '#ib_redo611_tmp'\n'#ib_redo588'  '#ib_redo596'  '#ib_redo604_tmp'  '#ib_redo612_tmp'\n'#ib_redo589'  '#ib_redo597'  '#ib_redo605_tmp'  '#ib_redo613_tmp'\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u4f18\u5316",children:"\u4f18\u5316"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"todo"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"qa",children:"Q&A"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u4e3a\u4ec0\u4e48\u53ea\u7528binlog\u4e0d\u884c","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"binlog\u4e0d\u77e5\u9053\u6570\u636e\u9875\u5237\u5165\u78c1\u76d8\u5bf9\u5e94\u7684\u70b9\uff08redolog\u7684checkpoint\uff09"}),"\n",(0,l.jsx)(n.li,{children:"\u5982\u679c\u6062\u590d\u7684\u8bdd\uff0c\u53ea\u80fd\u6062\u590d\u6ca1\u6709\u63d0\u4ea4\u7684\u6570\u636e\uff0c\u5148\u56de\u6eda\uff08undo log\uff09\u518d\u5e94\u7528"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u53ea\u7528redo log\u7684\u95ee\u9898","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u751f\u6001\u95ee\u9898\uff0c\u5f88\u591a\u4e2d\u95f4\u4ef6\u7528\u5230\u4e86binlog"}),"\n",(0,l.jsx)(n.li,{children:"\u6ca1\u6cd5\u8bb0\u5f55\u5386\u53f2\u6570\u636e\uff0c\u53ea\u6709\u5185\u5b58\u7684\u6570\u636e\uff0c\u8d77\u4e0d\u5230\u5f52\u6863\u7684\u4f5c\u7528"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u914d\u7f6e",children:"\u914d\u7f6e"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:"\n# --- MySQL 8.0.30 or Higher ---\n# redo log\u7684\u78c1\u76d8\u7a7a\u95f4,\u9ed8\u8ba4\u503c: 104857600 \u5b57\u8282 (100MB)\u3002\u6700\u5927\u91cd\u505a\u65e5\u5fd7\u5bb9\u91cf\u4e3a128GB\u3002\ninnodb_redo_log_capacity = 8589934592;\n# --- Before MySQL 8.0.30 ---\n# \u6bcf\u4e2a\u65e5\u5fd7\u6587\u4ef6\u7684\u5927\u5c0f\ninnodb_log_file_size = 256M\n# \u65e5\u5fd7\u6587\u4ef6\u7684\u6570\u91cf\ninnodb_log_files_in_group = 2 \n\n# redo log buffer\u7684\u5927\u5c0f\uff0c\u9ed8\u8ba4\u503c\u4e3a 16MB\uff0c\u5982\u679c\u7ecf\u5e38\u6267\u884c\u5927\u7684\u4e8b\u52a1\uff0c\u90a3\u4e0d\u59a8\u589e\u5927\u8fd9\u4e2a\u503c\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u524d\u907f\u514d\u5199\u5165\u78c1\u76d8\n# The size in bytes of the buffer that InnoDB uses to write to the log files on disk. The default is 16MB. A large log buffer enables large transactions to run without the need to write the log to disk before the transactions commit. \n# Thus, if you have transactions that update, insert, or delete many rows, making the log buffer larger saves disk I/O\ninnodb_log_buffer_size = 16MB\n# \u5237\u5165\u78c1\u76d8\u7684\u65f6\u673a\n# 1\uff1a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6\u90fd\u4f1a\u5c06\u65e5\u5fd7\u5199\u5165\u5e76\u5237\u65b0\u5230\u78c1\u76d8\u3002\uff08\u9ed8\u8ba4\uff09\n# 0\uff1a\u6bcf\u79d2\u5c06\u65e5\u5fd7\u5199\u5165\u5e76\u5237\u65b0\u5230\u78c1\u76d8\u4e00\u6b21\u3002\u672a\u5237\u65b0\u65e5\u5fd7\u7684\u4e8b\u52a1\u53ef\u80fd\u4f1a\u5728\u5d29\u6e83\u4e2d\u4e22\u5931\u3002\n# 2\uff1a\u65e5\u5fd7\u4f1a\u5728\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u540e\u5199\u5165\uff08\u628a redo log buffer \u91cc\u7684\u6570\u636e\u5199\u5165\u5230 os buffer \u4e2d\uff0c\u4f46\u4e0d\u7acb\u5373\u6267\u884cfsync () \uff09\uff0c\u5e76\u6bcf\u79d2\u5237\u65b0\u5230\u78c1\u76d8\u4e00\u6b21\u3002\u672a\u5237\u65b0\u65e5\u5fd7\u7684\u4e8b\u52a1\u53ef\u80fd\u4f1a\u5728\u5d29\u6e83\u4e2d\u4e22\u5931\u3002\ninnodb_flush_log_at_trx_commit = 1\n# redo log\u7684\u76ee\u5f55\ninnodb_log_group_home_dir = \n\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u67e5\u8be2",children:"\u67e5\u8be2"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"--redo log capacity resize mechanism\u7684\u72b6\u6001\nSHOW STATUS LIKE 'Innodb_redo_log_resize_status';\n+-------------------------------+-------+\n| Variable_name                 | Value |\n+-------------------------------+-------+\n| Innodb_redo_log_resize_status | OK    |\n+-------------------------------+-------+\n--redo log \u5bb9\u91cf\u9650\u5236\nmysql> SHOW STATUS LIKE 'Innodb_redo_log_capacity_resized';\n +----------------------------------+-----------+\n| Variable_name                    | Value     |\n+----------------------------------+-----------+\n| Innodb_redo_log_capacity_resized | 104857600 |\n+----------------------------------+-----------+\n\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}}}]);