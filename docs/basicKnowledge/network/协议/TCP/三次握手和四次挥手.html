<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-basicKnowledge/network/协议/TCP/三次握手和四次挥手" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">三次握手和四次挥手 | Yuikij&#x27;s  blog</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-test-site.com/kibou/img/avatar.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-test-site.com/kibou/img/avatar.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/kibou/docs/basicKnowledge/network/协议/TCP/三次握手和四次挥手"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="Yuikij&#x27;s  blog, blog, Yuikij"><meta data-rh="true" name="robots" content="index, follow"><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="google-site-verification" content="-xEN6xN-ZxgRBYd5yWu6wEmhSpllJZAZSLXGTAJkzzU"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="三次握手和四次挥手 | Yuikij&#x27;s  blog"><meta data-rh="true" name="description" content="流程图"><meta data-rh="true" property="og:description" content="流程图"><link data-rh="true" rel="icon" href="/kibou/img/avatar.jpg"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/kibou/docs/basicKnowledge/network/协议/TCP/三次握手和四次挥手"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/kibou/docs/basicKnowledge/network/协议/TCP/三次握手和四次挥手" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/kibou/docs/basicKnowledge/network/协议/TCP/三次握手和四次挥手" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/kibou/blog/rss.xml" title="Yuikij&#39;s  blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/kibou/blog/atom.xml" title="Yuikij&#39;s  blog Atom Feed"><link rel="stylesheet" href="/kibou/assets/css/styles.6949bbb9.css">
<script src="/kibou/assets/js/runtime~main.f1e38cd0.js" defer="defer"></script>
<script src="/kibou/assets/js/main.218c2375.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/kibou/"><div class="navbar__logo"><img src="/kibou/img/avatar.jpg" alt="to be kibou" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/kibou/img/avatar.jpg" alt="to be kibou" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Yuikij&#x27;s  blog</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">基础</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/kibou/docs/category/java-1">编程语言</a></li><li><a class="dropdown__link" href="/kibou/docs/basicKnowledge/framework/Mybatis/插件">软件框架</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/kibou/docs/basicKnowledge/network/协议/MQTT">网络</a></li><li><a class="dropdown__link" href="/kibou/docs/database/MySQL/SQL语句/CTE">数据库</a></li><li><a class="dropdown__link" href="/kibou/docs/algorithm">算法和数据结构</a></li><li><a class="dropdown__link" href="/kibou/docs/distributedSystems/MapReduce">分布式系统</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">应用</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/kibou/docs/basicSoftware/Git/shell">Git</a></li><li><a class="dropdown__link" href="/kibou/docs/category/常用命令-1">Linux</a></li><li><a class="dropdown__link" href="/kibou/docs/basicSoftware/Operation/CiCD">运维相关</a></li><li><a class="dropdown__link" href="/kibou/docs/basicSoftware/Design/建模语言">软件设计</a></li><li><a class="dropdown__link" href="/kibou/docs/basicSoftware/中间件/RabbitMq">中间件</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/kibou/docs/category/note记录-1">公开课</a><a class="navbar__item navbar__link" href="/kibou/docs/naturalLanguage/日语/文法/动词">语言</a><a class="navbar__item navbar__link" href="/kibou/blog">日记</a><a class="navbar__item navbar__link" href="/kibou/docs/ai/LLM/利用CF的worker实现gemini的key池代理">AI编程</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">备忘录</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/kibou/docs/memorandum/SuperGame/关于狗头护肤的简单探讨/page1">SG论坛</a></li><li><a class="dropdown__link" href="/kibou/docs/memorandum/深度解读/DDIA">深度解读</a></li><li><a class="dropdown__link" href="/kibou/docs/prepareExam/软考/错题集/真题">备考面试</a></li><li><a class="dropdown__link" href="/kibou/docs/memorandum/chatgpt/如何解除网站的复制粘贴限制">小贴士</a></li></ul></div><a class="navbar__item navbar__link" href="/kibou/about">关于</a><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><a href="https://books.yuisama.top" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">图书馆<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/Yuikij" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite" aria-pressed="true"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/kibou/docs/basicKnowledge/network/协议/MQTT">协议</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kibou/docs/basicKnowledge/network/协议/MQTT">MQTT</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/kibou/docs/basicKnowledge/network/协议/TCP/三次握手和四次挥手">TCP</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/kibou/docs/basicKnowledge/network/协议/TCP/三次握手和四次挥手">三次握手和四次挥手</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kibou/docs/basicKnowledge/network/协议/WebSocket">WebSocket</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/kibou/docs/basicKnowledge/network/遇到的问题/身份验证">遇到的问题</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/kibou/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">协议</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">TCP</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">三次握手和四次挥手</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>三次握手和四次挥手</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="流程图">流程图<a href="#流程图" class="hash-link" aria-label="Direct link to 流程图" title="Direct link to 流程图">​</a></h2>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="前置知识">前置知识<a href="#前置知识" class="hash-link" aria-label="Direct link to 前置知识" title="Direct link to 前置知识">​</a></h2>
<ul>
<li>TCP 状态枚举</li>
</ul>

































































<table><thead><tr><th>状态名</th><th>说明</th><th>常见出现场景</th></tr></thead><tbody><tr><td><strong>CLOSED</strong></td><td>初始/最终状态，无连接</td><td>连接未建立、已释放</td></tr><tr><td><strong>LISTEN</strong></td><td>监听状态  ，等待连接请求</td><td>服务端 <code>socket.bind()</code> + <code>listen()</code></td></tr><tr><td><strong>SYN-SENT</strong></td><td>已发送 SYN 等待对方 ACK</td><td>客户端主动连接时 <code>connect()</code></td></tr><tr><td><strong>SYN-RECEIVED</strong></td><td>收到 SYN 并回复 SYN+ACK</td><td>服务端收到连接请求后</td></tr><tr><td><strong>ESTABLISHED</strong></td><td>连接建立，数据可双向传输</td><td>正常通信中</td></tr><tr><td><strong>FIN-WAIT-1</strong></td><td>主动关闭，已发 FIN 等待 ACK</td><td>主动断开方</td></tr><tr><td><strong>FIN-WAIT-2</strong></td><td>收到对方 ACK，等待 FIN</td><td>主动断开方</td></tr><tr><td><strong>CLOSE-WAIT</strong></td><td>被动关闭，等待应用调用 close()</td><td>被动断开方</td></tr><tr><td><strong>CLOSING</strong></td><td>双方几乎同时发 FIN，等待 ACK</td><td>少见</td></tr><tr><td><strong>LAST-ACK</strong></td><td>被动关闭方已发 FIN 等待 ACK</td><td>被动断开方</td></tr><tr><td><strong>TIME-WAIT</strong></td><td>主动关闭方等待 2MSL</td><td>防止延迟报文影响新连接</td></tr></tbody></table>
<ul>
<li>TCP 报文属性（TCP Header 字段）</li>
</ul>

































































<table><thead><tr><th>字段</th><th>长度</th><th>说明</th></tr></thead><tbody><tr><td><strong>Source Port</strong></td><td>16 bit</td><td>源端口号</td></tr><tr><td><strong>Destination Port</strong></td><td>16 bit</td><td>目的端口号</td></tr><tr><td><strong>Sequence Number</strong></td><td>32 bit</td><td>序列号（seq），标识本报文段第一个字节的编号</td></tr><tr><td><strong>Acknowledgment Number</strong></td><td>32 bit</td><td>确认号（ack），表示期望收到的下一个字节编号</td></tr><tr><td><strong>Data Offset</strong></td><td>4 bit</td><td>TCP 头长度（以 32 位字为单位）</td></tr><tr><td>Reserved</td><td>3 bit</td><td>保留字段（未来用途）</td></tr><tr><td><strong>Flags（控  制位）</strong></td><td>9 bit</td><td>TCP 报文属性标志（见下表）</td></tr><tr><td>Window Size</td><td>16 bit</td><td>窗口大小（流量控制）</td></tr><tr><td>Checksum</td><td>16 bit</td><td>校验和（包含 TCP 头和数据）</td></tr><tr><td>Urgent Pointer</td><td>16 bit</td><td>紧急数据的偏移量</td></tr><tr><td>Options</td><td>可变</td><td>选项字段（MSS、窗口扩大、时间戳等）</td></tr></tbody></table>
<ul>
<li>TCP Flags（控制位标志）</li>
</ul>























































<table><thead><tr><th>标志</th><th>全名</th><th>作用</th></tr></thead><tbody><tr><td>URG</td><td>Urgent</td><td>紧急指针有效（很少用）</td></tr><tr><td><strong>ACK</strong></td><td>Acknowledgment</td><td>确认号有效</td></tr><tr><td><strong>PSH</strong></td><td>Push</td><td>立即推送数据给应用层</td></tr><tr><td><strong>RST</strong></td><td>Reset</td><td>复位连接（异常中断）</td></tr><tr><td><strong>SYN</strong></td><td>Synchronize</td><td>建立连接请求，同步序列号</td></tr><tr><td><strong>FIN</strong></td><td>Finish</td><td>释放连接请求</td></tr><tr><td>ECE</td><td>ECN Echo</td><td>拥塞控制（RFC 3168）</td></tr><tr><td>CWR</td><td>Congestion Window Reduced</td><td>拥塞控制响应</td></tr><tr><td>NS</td><td>Nonce Sum</td><td>拥塞控制增强（很少用）</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="三次握手">三次握手<a href="#三次握手" class="hash-link" aria-label="Direct link to 三次握手" title="Direct link to 三次握手">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="目的">目的<a href="#目的" class="hash-link" aria-label="Direct link to 目的" title="Direct link to 目的">​</a></h3>
<ul>
<li>双方确认对方的接收与发送能力正常（即双向通信能力 OK）。</li>
<li>交换 初始序列号（Initial Sequence Number, ISN），为后续可靠传输做准备。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="过程">过程<a href="#过程" class="hash-link" aria-label="Direct link to 过程" title="Direct link to 过程">​</a></h3>
<ol>
<li>第一次握手（C → S）</li>
</ol>
<ul>
<li>C 发送一个 SYN 报文（SYN=1），并选择一个初始序列号 seq = x。</li>
<li>目的：告诉 S “我要连接你，并且我的初始序列号是 x”。</li>
<li>此时 C 状态：SYN-SENT</li>
</ul>
<ol start="2">
<li>第二次握手（S → C）</li>
</ol>
<ul>
<li>S 收到 SYN 后，发送 SYN + ACK 报文（SYN=1, ACK=1），确认号 ack = x+1，并选择自己的初始序列号 seq = y。</li>
<li>目的：告诉 C “我收到你的请求了（ack=x+1），我也要连接你（SYN），我的序列号是 y”。</li>
<li>此时 S 状态：SYN-RECEIVED</li>
</ul>
<ol start="3">
<li>第三次握手（C → S）</li>
</ol>
<ul>
<li>C 收到 SYN+ACK 后，发送一个 ACK 报文，确认号 ack = y+1，seq = x+1。</li>
<li>目的：告诉 S “你的序列号我收到了，可以开始传数据了”。</li>
<li>此时双方进入 ESTABLISHED 状态，可以开始数据传输。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="qa">Q&amp;A<a href="#qa" class="hash-link" aria-label="Direct link to Q&amp;A" title="Direct link to Q&amp;A">​</a></h3>
<ul>
<li>为什么是三次握手？
<ul>
<li>网络存在延迟，服务器收到的 SYN 可能是客户端很久之前发送的</li>
<li>第三次握手是服务端确实当他收到SYN报文到时候，客户端是否还有想连接的意图</li>
<li>防止ESTABLISHED状态进入过早</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="四次挥手">四次挥手<a href="#四次挥手" class="hash-link" aria-label="Direct link to 四次挥手" title="Direct link to 四次挥手">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="过程-1">过程<a href="#过程-1" class="hash-link" aria-label="Direct link to 过程" title="Direct link to 过程">​</a></h3>
<ol>
<li>第一次挥手（C → S）</li>
</ol>
<ul>
<li>C 发送 FIN 报文（FIN=1，seq=u）。</li>
<li>表示 “我没有数据要发了，但还能接收你的数据”。</li>
<li>状态：FIN-WAIT-1</li>
</ul>
<ol>
<li>第二次挥手（S → C）</li>
</ol>
<ul>
<li>S 收到 FIN，发送 ACK 报文（ack=u+1，seq=v）。</li>
<li>表示 “我知道你没数据要发了”。</li>
<li>此时 S 可能还有数据要发送给 C，所以暂时不发 FIN。</li>
<li>状态：C 进入 FIN-WAIT-2，S 进入 CLOSE-WAIT</li>
</ul>
<ol start="3">
<li>第三次挥手（S → C）</li>
</ol>
<ul>
<li>S 发送完数据后，发 FIN 报文（FIN=1，seq=w，ack=u+1）。</li>
<li>表示 “我也没数据要发了”。</li>
<li>状态：S 进入 LAST-ACK</li>
</ul>
<ol start="4">
<li>第四次挥手（C → S）</li>
</ol>
<ul>
<li>C 收到 FIN，发送 ACK（ack=w+1，seq=u+1）。</li>
<li>表示 “收到你的断开请求，连接关闭”。</li>
<li>C 进入 TIME-WAIT 状态等待 2MSL（Maximum Segment Lifetime，报文最大生存时间）后彻底关闭，S 收到 ACK 后直接进入 CLOSED 状态。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="qa-1">Q&amp;A<a href="#qa-1" class="hash-link" aria-label="Direct link to Q&amp;A" title="Direct link to Q&amp;A">​</a></h3>
<ul>
<li>为什么 TCP 挥手需要有 TIME_WAIT 状态?
<ul>
<li>第四次挥手的ack报文可能丢失，如果丢失，服务端会重发FIN报文，这时候需要C端再次ACK</li>
<li>防止被动关闭方等待超时后再断连</li>
<li>确保网络中所有属于该连接的旧报文全部</li>
</ul>
</li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/kibou/docs/basicKnowledge/network/协议/MQTT"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">MQTT</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/kibou/docs/basicKnowledge/network/协议/WebSocket"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">WebSocket</div></a></nav><div style="margin-top:50px"></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#流程图" class="table-of-contents__link toc-highlight">流程图</a></li><li><a href="#前置知识" class="table-of-contents__link toc-highlight">前置知识</a></li><li><a href="#三次握手" class="table-of-contents__link toc-highlight">三次握手</a><ul><li><a href="#目的" class="table-of-contents__link toc-highlight">目的</a></li><li><a href="#过程" class="table-of-contents__link toc-highlight">过程</a></li><li><a href="#qa" class="table-of-contents__link toc-highlight">Q&amp;A</a></li></ul></li><li><a href="#四次挥手" class="table-of-contents__link toc-highlight">四次挥手</a><ul><li><a href="#过程-1" class="table-of-contents__link toc-highlight">过程</a></li><li><a href="#qa-1" class="table-of-contents__link toc-highlight">Q&amp;A</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Yuikij's blog, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>